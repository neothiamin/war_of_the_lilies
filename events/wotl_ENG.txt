########################################
# WOTL events for England              #
########################################

namespace = wotl_eng

#The State of Affairs
#This event is a brief rundown of the ongoing strife in France and the possibility of rebellion that may culminate in the War of the Lilies.
#England gets a few choices: they can go it alone, seek help from either Burgundy or Provence, or begin to delegate power, giving various French duchies cores on Northern France.
country_event = {

    id = wotl_eng.1
    title = wotl_eng.1.t
    desc = wotl_eng.1.desc
    picture = LIBERUM_VETO_eventPicture

    fire_only_once = yes

    trigger = {
        tag = ENG
        NOT = {
            is_year = 1445
        }
        owns_core_province = 183
    }

    mean_time_to_happen = {
        months = 4
    }

    immediate = {
        set_country_flag = wotl_eng_state_of_affairs_happened
    }

    #God is with us.
    option = {
        name = wotl_eng.1.a
    }
}

#Heir's Culture
#Had to do some hacky stuff for this one since the on_action doesn't work. :rage:
country_event = {

    id = wotl_eng.2
    title = wotl_eng.2.t
    desc = wotl_eng.2.desc
    picture = LIBERUM_VETO_eventPicture

    mean_time_to_happen = {
        months = 4
    }

    #Available for England/UnitedMonarchies if they either accepted the French or England before 1450
    trigger = {
        OR = {
            AND = {
                tag = ENG
                NOT = {
                    has_global_flag = wotl_war_started
                }
            }
            AND = {
                OR = {                    
                    tag = ENG
                    tag = ANF
                }                
                has_country_flag = wotl_eng_accepted_french
            }
        }
        owns_core_province = 183
        has_heir = yes
        NOT = {
            has_heir_flag = wotl_eng_heir_culture_event_fired
        }
    }

    immediate = {
        set_heir_flag = wotl_eng_heir_culture_event_fired
    }

    #[Root.Heir.GetSheHe] shall be raised in the true English fashion!
    option = {
        name = wotl_eng.2.a
        ai_chance = { factor = 50 }
        hidden_effect = {
            set_heir_culture = english
        }
    }

    #[Root.Heir.GetSheHe] ought to know the fineries of life on the Continent.
    option = {
        name = wotl_eng.2.b
        ai_chance = { factor = 35 }
        hidden_effect = {
            set_heir_culture = cosmopolitan_french
        }
    }

    #[Root.Heir.GetSheHe] will be raised in a way to mirror William the First!
    option = {
        name = wotl_eng.2.c
        ai_chance = { factor = 15 }
        hidden_effect = {
            set_heir_culture = normand
        }
    }
}

#Buckle up, here we go.
#Real War of the Lilies starts now.

#John the Invader executes Fleming for Conspiracy
country_event = {
    id = wotl_eng.3
    title = wotl_eng.3.t
    desc = wotl_eng.3.desc
    picture = LIBERUM_VETO_eventPicture

    fire_only_once = yes

    mean_time_to_happen = {
        months = 4
    }

    trigger = {
		normal_or_historical_nations = yes
        tag = ENG
        is_year = 1438
        NOT = {
            is_year = 1450
        }
        FLA = {
            has_ruler_flag = wotl_fla_john_the_invader
            is_subject_of = ENG
            is_at_war = no
        }
    }

    immediate = {
        #set_global_flag = wotl_jti_execution_happened
        FLA = {
            set_saved_name = {
                key = executed_fleming
                type = advisor
                scope = THIS
            }
        }
    }

    #We must support John.
    option = {
        name = wotl_eng.3.a
        ai_chance = {
            factor = 20
        }
        custom_tooltip = wotl_eng_3a_will_cause_unrest
        set_country_flag = wotl_eng_supported_jti
        #Used in another event.
        FLA = {
            set_ruler_flag = wotl_fla_jti_supported
        }
        hidden_effect = {
            clear_saved_name = executed_fleming
        }
    }
    
    #John has gone too far!
    option = {
        name = wotl_eng.3.b
        ai_chance = {
            factor = 80
        }
        custom_tooltip = wotl_eng_3b_john_angry
        set_country_flag = wotl_eng_did_not_support_jti
        #Used in another event.
        FLA = {
            set_ruler_flag = wotl_fla_jti_not_supported
        }
        hidden_effect = {
            clear_saved_name = executed_fleming
        }
    }
}

#John the Invader questions our legitimacy!
country_event = {
    id = wotl_eng.4
    title = wotl_eng.4.t
    desc = wotl_eng.4.desc
    picture = LIBERUM_VETO_eventPicture

    fire_only_once = yes
    
    mean_time_to_happen = {
        months = 4
    }

    trigger = {
		normal_or_historical_nations = yes
        tag = ENG
        has_global_flag = wotl_eng_legitimacy_questioned
        FLA = {
            has_ruler_flag = wotl_fla_john_the_invader
            is_subject_of = ENG
            is_at_war = no
        }
    }

    #Does he not know who gave him his title?!
    option = {
        name = wotl_eng.4.a
        ai_chance = {
            factor = 80
        }
        custom_tooltip = wotl_eng_4a_remove_jti
        hidden_effect = {
            random_list = {
                #JTI declares independence.
                50 = {
                    FLA = {
                        country_event = {
                            id = wotl_fla.6
                            days = 15
                            random = 5
                        }
                    }
                }
                #JTI questions executive power.
                35 = {
                    FLA = {
                        country_event = {
                            id = wotl_fla.5
                            days = 30
                            random = 5
                        }
                    }
                }
                #JTI removed.
                15 = {
                    add_prestige = 15
                    FLA = {
                        country_event = {
                            id = wotl_fla.4
                            days = 60
                            random = 15
                        }
                    }
                }
            }
        }
    }

    #John is more trouble than he's worth. He is on his own.
    option = {
        name = wotl_eng.4.b
        ai_chance = {
            factor = 20
        }
        set_global_flag = wotl_eng_king_weak
        FLA = {
            grant_independence = yes
        }
        add_prestige = -15
    }
}

#Council of Dukes (For other English subjects)
country_event = {
    id = wotl_eng.5
    title = wotl_eng.5.t
    desc = wotl_eng.5.desc
    picture = LIBERUM_VETO_eventPicture

    is_triggered_only = yes

    trigger = {
		is_subject_of = ENG
    }

    #Pledge our support to John!
    option = {
        name = wotl_eng.5.a
        set_country_flag = wotl_eng_council_of_dukes_support_fla
        ai_chance = {
            factor = 50
        }
    }

    #That's treason!
    option = {
        name = wotl_eng.5.b
        set_country_flag = wotl_eng_council_of_dukes_do_not_support_fla
        ai_chance = {
            factor = 50
        }
    }
}
