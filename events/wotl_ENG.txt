########################################
# WOTL events for England              #
########################################

namespace = wotl_eng

#The State of Affairs
#This event is a brief rundown of the ongoing strife in France and the possibility of rebellion that may culminate in the War of the Lilies.
country_event = {

    id = wotl_eng.1
    title = wotl_eng.1.t
    desc = wotl_eng.1.desc
    picture = LIBERUM_VETO_eventPicture

    fire_only_once = yes

    trigger = {
        tag = ENG
        NOT = {
            is_year = 1445
        }
        owns_core_province = 183
    }

    mean_time_to_happen = {
        months = 2
    }

    immediate = {
        set_country_flag = wotl_eng_state_of_affairs_happened
    }

    #God is with us.
    option = {
        name = wotl_eng.1.a
    }
}

#Heir's Culture
#Had to do some hacky stuff for this one since the on_action doesn't work. :rage:
country_event = {

    id = wotl_eng.2
    title = wotl_eng.2.t
    desc = wotl_eng.2.desc
    picture = LIBERUM_VETO_eventPicture

    mean_time_to_happen = {
        months = 4
    }

    #Available for ENG before WOTL or after accepting French people, or the UM
    trigger = {
        OR = {
            AND = {
                tag = ENG
                NOT = {
                    has_global_flag = wotl_war_started
                }
            }
            AND = {               
                tag = ENG               
                has_country_flag = wotl_eng_accepted_french
            }
            tag = ANF
        }
        owns_core_province = 183
        has_heir = yes
        NOT = {
            has_heir_flag = wotl_eng_heir_culture_event_fired
        }
    }

    immediate = {
        set_heir_flag = wotl_eng_heir_culture_event_fired
    }

    #[Root.Heir.GetSheHe] shall be raised in the true English fashion!
    option = {
        name = wotl_eng.2.a
        ai_chance = { factor = 50 }
        set_heir_culture = english
    }

    #[Root.Heir.GetSheHe] ought to know the fineries of life on the Continent.
    option = {
        name = wotl_eng.2.b
        ai_chance = { factor = 35 }
        set_heir_culture = cosmopolitan_french
    }

    #[Root.Heir.GetSheHe] will be raised in a way to mirror William the First!
    option = {
        name = wotl_eng.2.c
        ai_chance = { factor = 15 }
        set_heir_culture = normand
    }
}

#Buckle up, here we go.
#Real War of the Lilies starts now.

#John the Invader executes Fleming for Conspiracy
country_event = {
    id = wotl_eng.3
    title = wotl_eng.3.t
    desc = wotl_eng.3.desc
    picture = LIBERUM_VETO_eventPicture

    fire_only_once = yes

    major = yes

    is_triggered_only = yes

    trigger = {
		normal_or_historical_nations = yes
        tag = ENG
    }

    immediate = {
        set_global_flag = wotl_jti_execution_happened
    }

    #We must support John.
    option = {
        name = wotl_eng.3.a
        ai_chance = {
            factor = 20
        }
        custom_tooltip = wotl_eng_3a_will_cause_unrest
        set_country_flag = wotl_eng_supported_jti
        #Used in another event.
        FLA = {
            set_ruler_flag = wotl_fla_jti_supported
        }
    }
    
    #John has gone too far!
    option = {
        name = wotl_eng.3.b
        ai_chance = {
            factor = 80
        }
        custom_tooltip = wotl_eng_3b_john_angry
        set_country_flag = wotl_eng_did_not_support_jti
        #Used in another event.
        FLA = {
            set_ruler_flag = wotl_fla_jti_not_supported
        }
    }
}

#John the Invader questions our legitimacy!
country_event = {
    id = wotl_eng.4
    title = wotl_eng.4.t
    desc = wotl_eng.4.desc
    picture = LIBERUM_VETO_eventPicture

    fire_only_once = yes
    
    mean_time_to_happen = {
        months = 4
    }

    trigger = {
		normal_or_historical_nations = yes
        tag = ENG
        has_global_flag = wotl_eng_legitimacy_questioned
        FLA = {
            has_ruler_flag = wotl_fla_john_the_invader
            is_subject_of = ENG
            is_at_war = no
        }
    }

    #Does he not know who gave him his title?!
    option = {
        name = wotl_eng.4.a
        ai_chance = {
            factor = 80
        }
        custom_tooltip = wotl_eng_4a_remove_jti
        random_list = {
            #JTI declares independence.
            50 = {
                custom_tooltip = wotl_eng_4a_jti_indep
                hidden_effect = {
                    FLA = {
                        country_event = {
                            id = wotl_fla.6
                            days = 15
                            random = 5
                        }
                    }
                }
            }
            #JTI questions executive power.
            35 = {
                custom_tooltip = wotl_eng_4a_jti_question
                hidden_effect = {
                    FLA = {
                        country_event = {
                            id = wotl_fla.5
                            days = 30
                            random = 5
                        }
                    }
                }
            }
            #JTI removed.
            15 = {
                custom_tooltip = wotl_eng_4a_success
                hidden_effect = {
                    add_prestige = 15
                FLA = {
                    country_event = {
                        id = wotl_fla.4
                        days = 60
                        random = 15
                    }
                }
                }
            }
        }
    }

    #John is more trouble than he's worth. He is on his own.
    option = {
        name = wotl_eng.4.b
        ai_chance = {
            factor = 20
        }
        set_global_flag = wotl_eng_king_weak
        FLA = {
            grant_independence = yes
        }
        add_prestige = -15
    }
}

#Council of Dukes (For other English subjects)
country_event = {
    id = wotl_eng.5
    title = wotl_eng.5.t
    desc = {
        trigger = {
            FROM = {
                tag = FLA
            }
        }
        desc = wotl_eng.5.desc
    }
    desc = {
        trigger = {
            FROM = {
                NOT = {
                    tag = FLA
                }
            }
        }
        desc = wotl_eng.5.desc.b
    }
    picture = LIBERUM_VETO_eventPicture

    is_triggered_only = yes

    trigger = {
		is_subject_of = ENG
    }

    #Pledge our support to John!
    option = {
        name = wotl_eng.5.a
        set_country_flag = wotl_eng_council_of_dukes_support_fla
        ai_chance = {
            factor = 60
            modifier = {
                factor = 2
                NOT = {
                    has_opinion = {
                    	who = ENG
                    	value = 25
                    }
                }
            }
            modifier = {
                factor = 2
                has_opinion = {
                	who = FLA
                	value = 75
                }
            }
            modifier = {
                factor = 0.5
                has_opinion = {
                	who = ENG
                	value = 50
                }
            }
            modifier = {
                factor = 0.5
                NOT = {
                    has_opinion = {
                    	who = FLA
                    	value = 50
                    }
                }
            }
        }
        custom_tooltip = wotl_eng.5.a.tt
        hidden_effect = {
            FLA = {
                country_event = {
                    id = wotl_fla.11
                }
            }
        }
    }

    #That's treason!
    option = {
        name = wotl_eng.5.b
        set_country_flag = wotl_eng_council_of_dukes_do_not_support_fla
        ai_chance = {
            factor = 40
        }
    }
}

#Council of Dukes demands greater domains!
country_event = {
    id = wotl_eng.6
    title = wotl_eng.6.t
    desc = wotl_eng.6.desc
    picture = LIBERUM_VETO_eventPicture

    is_triggered_only = yes

    #Our hands are tied.
    option = {
        name = wotl_eng.6.a
        set_global_flag = wotl_eng_bends_to_council.6
        #Picardy area
        if = {
            limit = {
                exists = FLA
            }
            every_owned_province = {
                limit = {
                    area = picardy_area
                }
                add_core = FLA
                cede_province = FLA
            }
        }
        #Chester
        if = {
            limit = {
                exists = NOL
            }
            4375 = {
                if = {
                    limit = {
                        owned_by = ENG
                    }
                    add_core = NOL
                    cede_province = NOL
                }
            }  
        }      
        #Lancashire
        if = {
            limit = {
                exists = NOL
            }
            244 = {
                if = {
                    limit = {
                        owned_by = ENG
                    }
                    add_core = NOL
                    cede_province = NOL
                }
            }  
        } 
        #Loire area
        if = {
            limit = {
                exists = GUY
            }
            every_owned_province = {
                limit = {
                    area = loire_area
                }
                add_core = GUY
                cede_province = GUY
            }
        }
        #Poitou area
        if = {
            limit = {
                exists = GUY
            }
            every_owned_province = {
                limit = {
                    area = poitou_area
                }
                add_core = GUY
                cede_province = GUY
            }
        }
        #Alencon
        if = {
            limit = {
                exists = PRO
            }
            1879 = {
                if = {
                    limit = {
                        owned_by = ENG
                    }
                    add_core = PRO
                    cede_province = PRO
                }
            }
        }
        ai_chance = {
            factor = 30

            modifier = {
                factor = 2
                AND = {
                    NOL = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    FLA = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    GUY = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                }
            }
        }
    }

    #Never! Our lands are rightfully ours!
    option = {
        name = wotl_eng.6.b
        add_prestige = 10
        hidden_effect = {
            FLA = {
                country_event = {
                    id = wotl_fla.9
                }
            }
        }
        ai_chance = {
            factor = 70
            modifier = {
                factor = 0.5
                AND = {
                    NOL = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    FLA = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    GUY = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                }
            }
        }
    }

}
#Council of Dukes demands creation of a new vassal!
country_event = {
    id = wotl_eng.7
    title = wotl_eng.7.t
    desc = wotl_eng.7.desc
    picture = LIBERUM_VETO_eventPicture

    is_triggered_only = yes

    #We shall resurrect the Duchy of Normandy.
    option = {
        name = wotl_eng.7.a
        ai_chance = {
            factor = 20
            modifier = {
                factor = 3
                AND = {
                    NOL = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    FLA = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    GUY = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                }
            }
        }
        every_owned_province = {
            limit = {
                area = normandy_area
            }
            add_core = NRM
            cede_province = NRM
        }
        vassalize = NRM
        set_global_flag = wotl_eng_bends_to_council.7
    }

    #We shall create a new duchy on the Loire.
    option = {
        name = wotl_eng.7.b
        ai_chance = {
            factor = 20
            modifier = {
                factor = 3
                AND = {
                    NOL = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    FLA = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    GUY = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                }
            }
        }
        every_owned_province = {
            limit = {
                area = loire_area
            }
            add_core = ORL
            cede_province = ORL
        }
        vassalize = ORL
        set_global_flag = wotl_eng_bends_to_council.7
    }

    #We shall create a new duchy in the rich lands of Champagne.
    option = {
        name = wotl_eng.7.c
        ai_chance = {
            factor = 20
            modifier = {
                factor = 3
                AND = {
                    NOL = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    FLA = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    GUY = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                }
            }
        }
        every_owned_province = {
            limit = {
                area = champagne_area
            }
            add_core = CHP
            cede_province = CHP
        }
        vassalize = CHP
        set_global_flag = wotl_eng_bends_to_council.7
    }

    #Refuse!
    option = {
        name = wotl_eng.7.d
        ai_chance = {
            factor = 40
            modifier = {
                factor = 0.2
                AND = {
                    NOL = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    FLA = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                    GUY = {
                        has_country_flag = wotl_eng_council_of_dukes_support_fla
                    }
                }
            }
        }
        add_prestige = 10
        hidden_effect = {
            FLA = {
                country_event = {
                    id = wotl_fla.9
                }
            }
        }
    }
    
}

#John de Armagnac is Worried
country_event = {
    id = wotl_eng.8
    title = wotl_eng.8.t
    desc = wotl_eng.8.desc
    picture = LIBERUM_VETO_eventPicture

    is_triggered_only = yes

    #Assure him he is safe.
    option = {
        name = wotl_eng.8.a
        ai_chance = {
            factor = 30            
        }
        GUY = {
            country_event = {
                id = wotl_guy.2
            }
        }
    }

    #Demand loyalty.
    option = {
        name = wotl_eng.8.b
        ai_chance = {
            factor = 70            
        }
        custom_tooltip = wotl_eng.8.b.tt
        hidden_effect = {
            GUY = {
                country_event = {
                    id = wotl_guy.3
                }
            }
        }
    }
}

#War with Burgundy!
country_event = {
    id = wotl_eng.9
    title = wotl_eng.9.t
    desc = {
        trigger = {
            AND = {
                war_with = BUR
                war_with = FLA
                FLA = {
                    has_country_flag = wotl_fla_independence
                }
            }
        }
        desc = wotl_eng.9.desc.a
    }
    desc = {
        trigger = {
            AND = {
                war_with = BUR
                has_country_flag = wotl_eng_supported_jti
            }
        }
        desc = wotl_eng.9.desc.b
    }
    picture = LIBERUM_VETO_eventPicture

    fire_only_once = yes

    trigger = {
        tag = ENG
        BUR = {
            has_country_modifier = wotl_bur_flemish_war_modifier
        }
        OR = {
            AND = {
                war_with = BUR
                war_with = FLA
                FLA = {
                    has_country_flag = wotl_fla_independence
                }
            }
            AND = {
                war_with = BUR
                has_country_flag = wotl_eng_supported_jti
            }
        }
    }

    mean_time_to_happen = {
        days = 15
    }

    #Damn them! They will pay for this!
    option = {
        name = wotl_eng.9.a
        if = {
            limit = {
                NOT = {
                    has_country_modifier = wotl_eng_flemish_revolt
                }
            }
            add_country_modifier = {
                name = wotl_eng_flemish_revolt
                duration = -1            
            }
        }
    }
}

#Defeat in [ROOT.GetName]!
province_event = {
    id = wotl_eng.10
    title = wotl_eng.10.t
    desc = wotl_eng.10.desc
    picture = LIBERUM_VETO_eventPicture

    is_triggered_only = yes

    trigger = {
        OR = {
            owner = {
                OR = {
                    tag = BUR
                    is_subject_of = BUR
                }
            }
            owner = {
                OR = {
                    tag = ENG
                    is_subject_of = ENG
                }
            }
        }
        FROM = {
            tag = ENG
        }
        NOT = {
            has_global_flag = wotl_eng_big_defeat
        }
        BUR = {
            has_country_modifier = wotl_bur_flemish_war_modifier
        }
    }    

    immediate = {
        set_global_flag = wotl_eng_big_defeat
    }

    #Blast! We must not let this phase us!
    option = {
        name = wotl_eng.10.a
        FROM = {
            remove_country_modifier = wotl_eng_flemish_revolt
            add_country_modifier = {
                name = wotl_eng_big_defeat_effect
                duration = -1
            }
        }
    }
}

#John of Beaufort declares independence!
country_event = {
    id = wotl_eng.11
    title = wotl_eng.11.t
    desc = wotl_eng.11.desc
    picture = LIBERUM_VETO_eventPicture

    is_triggered_only = yes

    fire_only_once = yes

    #Reassert control!
    option = {
        name = wotl_eng.11.a
        declare_war_with_cb = {
            casus_belli = cb_annex
            who = FLA
        }
        add_country_modifier = {
            name = wotl_eng_flemish_revolt
            duration = -1            
        }
    }
}